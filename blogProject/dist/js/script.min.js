/*Admin user*/
// function adminDelete( arr, user ) {
//     const delElements = [ ...document.querySelectorAll( 'div.coment-block__coment-user > p:last-child' ) ];
//     let target,
//         blogIndex,
//         targetId;

//     delElements.forEach( (el, i) => {
//         el.onclick = ( e ) => {
//             if ( blogList[ i ].coments[ e.target.id ].user == user ) {
//                 target = Number( e.target.className );
//                 blogIndex = blogList.findIndex( el => el.number == target );
//                 targetId = blogList[ target ].coments.findIndex( el => el.id == Number( e.target.id ) );
//                 blogList[ blogIndex ].coments.splice( targetId, 1 );
//                 localStorage.setItem('blogList', JSON.stringify(blogList));
//                 renderList( arr, result, user );
//             };
//         };
//     });
// };

/*Для хардкода масива*/
// let blogList = [
//     {
//         number: 0,
//         userPublicated: 'Andrii Dmytruk',
//         topic: 'Sport',
// 		image: '../img/coby.jpg',
//         title: 'America mourns Kobe Bryant after death in helicopter crash.',
//         time: '2019-02-6 00:20:18',
//         like: 0,
//         coments: [{
//             id: 0,
//             user: 'Albert',
//			   'timePublic': '2020-11-1 11:24:41',
//             page: 'Very sorry!'
//         }],
//         page: `Bryant, 41, was one of the most famous athletes in America. 
// 		        When his death was confirmed on Sunday, television broadcasts were interrupted for breaking news bulletins.
// 		        Seven others died in the crash, including a well-known California college baseball coach, John Altobelli, and his wife and daughter, Keri and Alyssa.
// 				California authorities did not immediately confirm the identities of the victims but friends and family members said Gianna’s basketball coach, Christina Mauser, and Ara Zobayan, the aircraft’s pilot, also died.
// 		 		The other two victims were identified as Sarah Chester and her daughter Peyton, a team-mate of Gianna.
// 				The National Transportation Safety Board was investigating the crash, which occurred in foggy conditions on Sunday morning, 30 miles north-west of downtown Los Angeles. The medical examiner said it could take days to recover the remains of the victims due to the rugged terrain at the crash site.
// 				`
//     },
//     {   
//         number: 1,
//         userPublicated: 'Oleg',
//         topic: 'Sport',
//         image: '../img/barty.jpg',
//         title: 'Ashleigh Barty on course for Australian Open summit with Simona Halep',
//         time: '2019-12-21 00:20:18',
//         like: 0,
//         coments: [],
//         page: `If Ashleigh Barty is to become the first Australian to win the women’s title since Christine O’Neill 42 years ago, she more than likely will have to beat Simona Halep, the only player in either draw yet to lose a set this fortnight.
// 				Barty’s first challenge is in the second semi-final on Thursday, when she plays the vibrant American world No 14, Sofia Kenin, who was too strong for the Tunisian, Ons Jabeur, in her quarter-final on Tuesday, winning in straight sets in an hour-and-a-half.
// 				But Halep has hit an altogether more frightening level of excellence from day one. 
// 				Twice in her life she has flirted with what passes for perfection in tennis.
// 				The first time was last summer in the final at Wimbledon when she embarrassed the greatest player of all time, Serena Williams, in 56 minutes.
// 				She allowed the owner of 23 majors just four games that afternoon.
// 				`
//     },
//     {
//         number: 2,
//         userPublicated: 'Isaak',
//         topic: 'Travelling',
//         image: '../img/passport.jpg',
//         title: `A Woman Flew From London to Berlin Using Her Baby's Passport and No One Noticed'`,
//         time: '2019-11-28 01:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		You never know how important your passport is until you need it the most.
// 				According to the Daily Star, a London woman flew all the way from London Luton Airport to Berlin on an Easyjet flight before realizing she was traveling on her baby son’s passport. She even had it scanned at security before her flight, but no one caught it.
// 				Masters student Lenesha Riley was heading to Berlin with her mother and friend for a short weekend getaway, according to the Daily Mail. The passport she was traveling with was scanned at her departure gate, and Riley was allowed through without any problems.
// 				It wasn’t until she arrived at security in the Berlin airport that she noticed she actually had her son, Josiah’s, passport in her hands.
// 				“When it was time to board the plane, the passport was scanned and the lady just gave it back to me,” Riley told the Daily Mail. “I got to Berlin and had the passport out for security, and that's when I realized. It felt like my heart sank to my toes and I thought, 'Oh my god.”
// 			`
//     },
//     {
//         number: 3,
//         userPublicated: 'Leonid',
//         topic: 'Travelling',
//         image: '../img/corona.jpg',
//         title: 'This Map Shows Where the Coronavirus Is Spreading in Real Time',
//         time: '2018-10-14 01:20:18',
//         like: 0,
//         coments: [],
//         page: `
// 		        The coronavirus, which causes flu-like symptoms as well as pneumonia, is spreading fast.
// 		        So fast, in fact, that scientists at Johns Hopkins University felt that it was important to track just where the virus exists with a real-time map that’s now available to the public.
// 				"We built this dashboard because we think it is important for the public to have an understanding of the outbreak situation as it unfolds with transparent data sources," Lauren Gardner, a civil engineering professor and co-director for Center for Systems Science and Engineering, said of the map in a statement. "For the research community, this data will become more valuable as we continue to collect it over time."
// 			`
//     },
//     {
//         number: 4,
//         userPublicated: 'Albert Petrov',
//         topic: 'Kitchen',
//         image: '../img/radar.jpg',
//         title: 'RADAR at Maison&Objet',
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		The coffee table and wall lamps in the Solco line, which are characterised by a highly original use of Carrara marble, will be exhibited in the What’s new section in Hall 4.
//         		The exhibition is curated by Elizabeth Leriche, François Bernarde and François Delclaux and collects the most interesting new products of the recent past, all selected according to criteria of aesthetical innovation and know-how in the workmanship of the materials.
//         		The Solco collection, with its thin stone surfaces carved with a wave pattern that was hand-drawn by RADAR’s designers with sinuous lines in relief, acquires a dynamic, light, and poetic overall appearance as it is transformed into a tactile surface, which is classic and contemporary at once.
//         	`
//     },
//         {
//         number: 5,
//         userPublicated: 'Leonid',
//         topic: 'Kitchen',
//         image: '../img/nature.jpg',
//         title: 'Nature’s Bounty',
//         time: '2018-10-14 01:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		A walk through the woods, a stroll by the sea or a hike in the mountains each trigger a spiritual calm. That disconnect from daily stress is achieved through a connection with nature, the deep breathing of fresh air and the visual play of an abundance of color.
// 				More than ever, homeowners are seeking to bring the colors of the outdoors home with them, carefully choosing earth-inspired hues for cabinets, walls, countertops and more to help them retain the feeling of well-being that goes with being in nature.
// 				Whether opting for neutral tones or bright pops, color choices for 2020 and beyond are all about what’s real.
// 			`
//     },
//     {
//         number: 6,
//         userPublicated: 'Petrov',
//         topic: 'IT news',
//         image: '../img/amda.jpg',
//         title: 'SAVE MONEY ON YOUR ELECTRIC BILL & SUPPORT CLEAN ENERGY WITH ARCADIA',
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		Sustainable energy farms generate far more power than ever before, and yet, most homeowners have no idea how to switch to renewable sources. If you’re interested in powering your home with clean energy, you don’t have to buy expensive solar panels or switch utility companies. In fact, if you can even save money by switching to renewable energy with Arcadia. 
// 				Arcadia is a platform that makes it easy for renters and homeowners to support green energy. All you need to do is create an account with Arcadia and connect your utility bill. Arcadia will power your home by locating clean energy farms near you. Additionally, if the energy farm in your area produces clean energy at a cheaper rate, you’ll save money on your monthly power bill. 
// 				Anyone who pays a utility bill can sign up today for Arcadia. Find out how Arcadia can save you money by switching to renewable energy, and earn a $20 Amazon gift card just by signing up. 
// 				This story, "Save money on your electric bill & support clean energy with Arcadia " was originally published by Macworld.
// 			`
//     },
//     {
//         number: 7,
//         userPublicated: 'Damir',
//         topic: 'IT news',
//         image: '../img/it.jpg',
//         title: 'BEST TRUE WIRELESS EARBUDS: FREE YOURSELF FROM THE TYRANNY OF CORDS',
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		Earbud makers have been busy doing away with wires—a good thing whether or not your phone still has a headset jack. You no longer have to deal with cords if you don’t want to. True wireless earbuds connect to one another and your audio source via Bluetooth.
// 		        No wires mean no inline microphones or controls, but truly wireless earbuds sound just as good as traditional Bluetooth counterparts (for better or worse). They also boast all of the features we’ve come to expect from earbuds designed to work with your smartphone, tablet, or PC.
// 				Since Apple’s AirPods became a runaway hit, an endless stream of companies have rolled out their own true wireless earbuds and earphones. As you might expect, not all of them are worth your time or money—so we’ve got your back with buying suggestions to meet a wide variety of needs.
// 			`
//     },
//     {
//         number: 8,
//         userPublicated: 'Albert Petrov',
//         topic: 'Music',
//         image: '../img/awards.jpg',
//         title: 'New Hair, Who Dis? 9 Times Latin Urban Artists Surprised Fans With a Mane Makeover',
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
// 		        Maluma poses in the press room during the 19th annual Latin Grammy Awards at MGM Grand Garden Arena on Nov. 15, 2018 in Las Vegas.
// 				Earlier this week, Anuel AA revealed his new haircut, chopping off his signature bangs and opting for a fresh buzz cut.
// 				Though the new look is fitting, many of his fans were in total disbelief.
// 				But the Puerto Rican trap star is not the only urban act to surprise fans with a mane makeover. From J Balvin to Jon Z, check out nine transformations below.
// 				ANUEL AA
// 				With his eyes shut and utensils in hand ahead of dinner, the “China” singer repeatedly prayed to God to please make his hair grow.
// 			`
//     },
//     {
//         number: 9,
//         userPublicated: 'Albert Petrov',
//         topic: 'Music',
//         image: '../img/bieber.jpg',
//         title: `'Bieber Is Back': Watch Episode 2 of Justin Bieber's 'Seasons' Docuseries Now`,
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		Kendall Jenner makes a brief cameo in the latest ep.
// 				Drumroll, please! Justin Bieber is back with episode 2 of Seasons, his 10-part YouTube docuseries, released Wednesday (Jan. 29) for non-YouTube Premium subscribers to watch.
// 				The global superstar taps on the drums and taps into the months-long recording process of Changes, his fifth studio album due Valentine's Day. 
// 				Josh Gudwin, Bieber's longtime producer/mixer/engineer, is an integral part of the process, and in this episode, he explains their fastidious routine.
// 				"Josh is kind of the recording sherpa," Allison Kaye, part of the "Yummy" singer's management team, says during the clip. "Josh is really the only one in the room, cutting him and vocal producing him and helping him pick the songs. Josh is a very integral part of Justin making music and has been since the beginning. There isn't an album Justin has worked on that Josh hasn't been a part of with him."
// 			`
//     },
//     {
//         number: 10,
//         userPublicated: 'Albert Petrov',
//         topic: 'News',
//         image: '../img/britons.jpg',
//         title: 'The Britons getting out before Brexit ‘drawbridge’ goes up',
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
//         		Sue Wilson, the founder of campaign group Bremain in Spain, says now that Brexit is “concrete and is happening” they are seeing evidence of Britons “expediting their plans” for retirement or a career move to Spain.
// 				Under the withdrawal agreement British nationals can settle in another EU member state right up to 31 December and claim lifetime rights as EU citizens.
// 				“We have people inquiring what the rules are and we are saying to people that as long as they move before 31 December they will have the same rights as those of us who are already here.
// 				It is in the withdrawal agreement,” says Wilson.
// 				“Even if you haven’t reached pension age and you have paid in for enough years to make you eligible you will have the right to an uprated pension for life under the withdrawal agreement.”
// 				Not all rights are guaranteed and the campaign group British in Europe has urged Brussels and London to secure those that have yet to be negotiated, which include freedom of movement and the right to return to the UK with an EU family member after Brexit. 
// 				But the rights to study, work and retire remain for those moving before 2021.
// 			`
//     },
//     {
//         number: 11,
//         userPublicated: 'Albert Petrov',
//         topic: 'News',
//         image: '../img/colbert.jpg',
//         title: `Emotional Stephen Colbert tells of family plane tragedy after Kobe Bryant's death`,
//         time: '2019-03-31 02:20:18',
//         like: 0,
//         coments: [],
//         page: `
// 	        	Stephen Colbert
// 				After taking Monday off, Stephen Colbert reflected on the death of Kobe Bryant on Tuesday night’s Late Show. The NBA legend died at 41 in a helicopter crash with his 13-year-old daughter and seven friends on Sunday, and though Colbert never met him, he said he felt “a strange connection” to this particular type of tragedy: when he was 10, Colbert’s father and two older brothers died in a plane crash that was also in heavy fog. “One of the terrible things about that shock, and the heartbreaking … unreality … nightmare quality of someone huge in your life who just disappears is not knowing what happened,” he said.
// 				Unlike a plane, Colbert continued, helicopters don’t have on-board flight recorders – so-called “black boxes” – which can aid investigations. The plane carrying his father and brothers had a flight recorder, “and because investigators knew what happened in that cockpit, new rules were created to save other people’s lives”.
// 			`
//     },
// ];
// localStorage.clear();
// localStorage.setItem('LogOn', JSON.stringify('Admin'));
// localStorage.setItem('blogList', JSON.stringify(blogList));

let blogList = JSON.parse(localStorage.getItem('blogList'));
/*Btn Active*/
function btnActive() {
    let indexSelect = document.getElementById( 'add-article__select_heading' ).options.selectedIndex,
        select = document.getElementById( 'add-article__select_heading' ).options[ indexSelect ].value,
        btnPush = document.getElementById( 'push_article' ),
        newTitle = document.getElementById( 'add-article__title' ).value,
        newPage = document.getElementById( 'add-article__page' ).value;
        // btnPush.setAttribute('disabled', 'disabled');
        // btnPush.setAttribute('disabled', 'true');
        console.log(btnPush)
    if (newTitle !== '' && newPage !== '' && select !== 'Select topic') {
        btnPush.style.height = '35px'
        btnPush.style.fontSize = '11px'
        btnPush.style.transition = '1s'
        // btnPush.disabled = false
    }
};
document.getElementById( 'add-article__select_heading' ).onchange= () => btnActive();
/*Button Hide*/
function btnHide() {
    const btnLogoBlock = [ ...document.querySelectorAll( 'div#header-block__logo > div > button' ) ];
    btnLogoBlock[ 2 ].style.display = 'block';
    btnLogoBlock[ 0 ].style.display = 'none';
    btnLogoBlock[ 1 ].style.display = 'none';
};
( () => {
    let bol = true;
    const menueBtn = document.getElementsByClassName( 'header-block__menue-button' )[ 0 ];
    const menue = document.getElementsByClassName( 'header-block__nav-menu-480-320' );
    menueBtn.onclick = function () {
        if ( bol == true ) {
            menue[ 0 ].style.display = 'block';
            menueBtn.style.zIndex = '5';
            bol = false;
        } else {
            menue[ 0 ].style.display = 'none';
            bol = true;
        }
    }
})();
// /*Change value*/
function getValueSelect( id ) {
    const indexSelect = document.getElementById( id ).options.selectedIndex;
    const select = document.getElementById( id );
    return select.options[ indexSelect ].text;
};

function selectHeading( user, state ) {
    let new_arr_heading;
    document.getElementById( 'select_heading' ).addEventListener( 'change', e => {
        e.preventDefault();
        new_arr_heading = filterVal( getValueSelect( e.target.id ), blogList );
        if ( getValueSelect( e.target.id ) == 'Select topic') {
            renderList( blogList.slice( 0, 5 ), result, user, state );
            pagination( blogList, user );
        } else if ( getValueSelect( e.target.id ) == 'Show all' ) {
            renderList( blogList, result, user, state );
        } else if (getValueSelect( e.target.id ) !== 'Select topic') {
            renderList( new_arr_heading, result, user, state);
            pagination( new_arr_heading, user );
        };
    });
};

function selectTime( user, state ) {
    document.getElementById( 'select_time' ).addEventListener( 'change', e => {
        e.preventDefault();
        const indexSelect = document.getElementById( 'select_heading' );
        const new_arr_time = filterVal( getValueSelect( indexSelect.id ), blogList );

        if ( getValueSelect( indexSelect.id ) == 'Select topic' ) {
            sortTime( blogList, getValueSelect( e.target.id ) );
            renderList( blogList.slice( 0, 5 ),result, user, state );
            pagination( blogList, user );
        } else {
            sortTime( new_arr_time, getValueSelect( e.target.id ) );
            renderList( new_arr_time, result, user, state);
            pagination( new_arr_time, user )
        }
    });
};
/*Add Coments*/
function comentator( list, user, state ) {
    let article = [ ...document.querySelectorAll( 'div.coment-block > textarea' ) ];
    let comentBtn = [ ...document.querySelectorAll( 'button.coment-block__btn' ) ];
    let obj;
    
    comentBtn.forEach( ( el,i ) => {
        el.addEventListener( 'click', e => {
            e.preventDefault();
            let target = Number(e.target.name);
            if ( article[ i ].value == '' ) {
                alert( 'Before sending, fill in the comment field!' )
            } else if (  target  == list[ i ].number ) {
                obj = {
                    'id': list[ i ][ 'coments' ].length,
                    'user': user,
                    'timePublic': new Date().getFullYear() + '-' + new Date().getMonth()+1 + '-' + new Date().getDate()+ ' ' + new Date().getHours() + ':' + new Date().getMinutes()+ ':' + new Date().getSeconds(),
                    'page': article[ i ].value,
                }
                list[ i ][ 'coments' ].push( obj );
                localStorage.setItem('blogList', JSON.stringify(blogList));
                renderList( list, result, user, state );
            };
        });
    });
};
/*Create coment block*/
function createBlogBlock( list, el, user ) {
    list.forEach(obj =>{
    let new_block = document.createElement( 'div' ),
        time = document.createElement( 'p' ),
        linkWriter = document.createElement( 'a' ),
        title = document.createElement( 'h2' ),
        image = document.createElement( 'img' ),
        page = document.createElement( 'p' ),
        like = document.createElement( 'span' ),
        sentBlock = document.createElement( 'div' ),
        coment = document.createElement( 'div' ),
        link = document.createElement( 'a' ),
        forComent = document.createElement( 'textarea' ),
        btnComent = document.createElement( 'button' );
        new_block.className = 'result__render-article';
        title.className = obj.number;
        image.setAttribute( 'src', obj.image);
        time.className = 'time';
        like.className = obj.number;
        page.className = 'article';
        coment.className = 'coment-block';
        btnComent.className = 'coment-block__btn';
        sentBlock.className = 'article-block';
        forComent.name = obj.number;
        btnComent.name = obj.number;
        sentBlock.appendChild( title );
        sentBlock.appendChild( image )
        sentBlock.appendChild(linkWriter);
        sentBlock.appendChild( time );
        sentBlock.appendChild( page );
        sentBlock.appendChild( like );
        new_block.appendChild( sentBlock );
        new_block.appendChild( coment );
        coment.appendChild( link );
        coment.appendChild( forComent );
        coment.appendChild( btnComent );
        forComent.placeholder = 'Coment please ...'
        linkWriter.innerHTML = obj.userPublicated;
        time.innerHTML = obj.time;
        title.innerHTML = obj.title;
        page.innerText = obj.page;
        link.innerHTML = user;
        like.innerText = obj.like;
        btnComent.innerHTML = 'To comment';
        el.appendChild( new_block );
        createComentBlock( obj, user, coment )
    });
};

function createComentBlock( obj, user, block ) {
    obj.coments.forEach( ( el,i ) => {
            listComent = document.createElement( 'div' );
            linkUser = document.createElement( 'a' );
            timeComent = document.createElement( 'span' );
            sentComent = document.createElement( 'p' );
            delComent = document.createElement( 'span' );
            listComent.className = 'coment-block__coment-user';
            sentComent.className = obj.number;
            sentComent.id = obj.coments[i].id;
            delComent.className = obj.number;
            delComent.id = obj.coments[i].id;
            listComent.appendChild(linkUser);
            listComent.appendChild(timeComent);
            listComent.appendChild(sentComent);
            listComent.appendChild( delComent );
            block.appendChild( listComent );
            timeComent.innerHTML = obj.coments[i].timePublic;
            linkUser.innerHTML = el.user;
            sentComent.innerHTML = el.page;
            delComent.innerHTML = 'Delete';

    });
};
/*Delete coments*/
function deleteComent( arr, user, state ) {
    const delElements = [ ...document.querySelectorAll( 'div.coment-block__coment-user > span:last-child' ) ];
    let target,
        blogIndex,
        targetId;

    delElements.forEach( (el, i) => {
        el.onclick = ( e ) => {
            target = Number( e.target.className );
            blogIndex = blogList.findIndex( el => el.number == target );
            targetId = blogList[ blogIndex ].coments.findIndex( el => el.id == Number( e.target.id ) );
            if ( blogList[ blogIndex ].coments[ targetId ].user == user ) {
                blogList[ blogIndex ].coments.splice( targetId, 1 );
                localStorage.setItem('blogList', JSON.stringify(blogList));
                renderList( arr, result, user, state );
            } else {
                alert('You cannot delete someone else’s comment!')
            };
        };
    });
};
/*Edit coments*/
function editComent( obj, user ) {
    const createElements = [ ...document.querySelectorAll( 'div.coment-block__coment-user' ) ];
    const innerElements = [ ...document.querySelectorAll( '.coment-block__coment-user > p' ) ];
    const pageClass = [ ...document.querySelectorAll( '.coment-block__coment-user > span:last-child' ) ];
    let inputRefresh;
    let textCreate;
    let target;

    innerElements.forEach( ( el,i ) => {
        el.onclick = ( e ) => {
            inputRefresh = document.createElement( 'button' );
            textCreate = document.createElement( 'textarea' );
            inputRefresh.className = pageClass[ i ].className;
            inputRefresh.id = pageClass[ i ].id;
            textCreate.value = innerElements[ i ].innerHTML;
            inputRefresh.innerText = 'Refresh';
            createElements[ i ].appendChild(textCreate);
            createElements[ i ].appendChild( inputRefresh )
                inputRefresh.onclick = ( e ) => {
                    target = Number( e.target.className );
                    blogIndex = blogList.findIndex( el => el.number == target );
                    targetId = blogList[ blogIndex ].coments.findIndex( el => el.id == Number( e.target.id ) );
                    blogList.forEach( ( el, i ) => {
                    if ( blogList[ blogIndex ].number == target && blogList[ blogIndex ].coments[ targetId ].user == user ) {
                        blogList[ blogIndex ].coments[ targetId ].page = textCreate.value;
                        inputRefresh.style.display = 'none';
                        textCreate.style.display = 'none';
                        localStorage.setItem('blogList', JSON.stringify(blogList));
                        renderList( obj, result, user, true );
                    } else {
                        // alert('You cannot edit someone else’s comment!')
                        inputRefresh.style.display = 'none';
                        textCreate.style.display = 'none';
                    };
                });
            };
        };
    });
};
/*Filter blog*/
function filterVal( val,list ) {
    return list.filter( item => {
    if( item.topic.indexOf( val ) != -1 )
        return item;
    })
};
function regProcess( input, btn ) {
    const objUser = {};
    let boolean = false;
    let newUser;
    const regBlock = document.getElementById( 'header-block__registration' );
    btn.onclick = el => {
        if ( input[ 0 ].value !== '' && input[ 1 ].value !== '' && input[ 3 ].value !== '' && boolean == false ) {
            for( let i = 0; i < localStorage.length; i++ ) {
                if ( localStorage.key( i ) == input[ 0 ].value ) {
                    boolean = true;
                    alert( 'You are already registered!' );
                } else if ( localStorage.key( i ) == '' ) {
                    localStorage.removeItem( '' );
                } 
            };
            if ( boolean == false && input[ 1 ].value == input[ 2 ].value ) {
                newUser = input[ 0 ].value;
                input.forEach( el => objUser[ el.className ] = el.value );
                localStorage.setItem( newUser, JSON.stringify( objUser ) );
                alert( 'You have successfully registered!' );
                regBlock.style.display = 'none';
                localStorage.setItem( 'LogOn', JSON.stringify( newUser ) );
                stateStatus( true, newUser );
            } else if ( input[ 1 ].value !== input[ 2 ].value ){
                alert( 'Password fields do not match' );
            }
            input.forEach( el => el.value = '' );
        } else {
            input.forEach( el => el.value == '' ? el.placeholder = 'Incorrect filling' : el.value );
        };
    };
};

function signIn( button, input, signBlock, regBlock ) {
    let boolean = false;
    let objPars;
    button.onclick = () => {
        if ( input[ 0 ].value !== '' && input[ 1 ].value !== '' && boolean == false ) {
            for( let i = 0; i < localStorage.length; i++ ) {
                objPars = JSON.parse( localStorage[ localStorage.key( i ) ] );
                if ( localStorage.key( i ) == input[ 0 ].value && objPars.pass == input[ 1 ].value ) {
                    boolean = true;
                    userLogged = localStorage.key( i );
                    signBlock.style.display = 'none';
                    localStorage.setItem( 'LogOn', JSON.stringify( userLogged ) );
                    stateStatus ( true, userLogged );
                }
            }
            if ( boolean == false ) {
                alert('User not registered(')
                regBlock.style.display = 'block';
                signBlock.style.display = 'none';
            }
            input.forEach( el => el.value = '' );
        } else {
            input.forEach( el => el.value == '' ? el.placeholder = 'Fill field' : el.value );
        }
    }
};
/*Likes counter*/
function liker( list, user, state ) {
    let targetNum;
    let resultBlock = [ ...document.querySelectorAll( '.article-block > span' ) ]
        .forEach( ( el, i ) => {
            el.addEventListener( 'click', e => {
            e.preventDefault();
            targetNum = list.findIndex( item => item.number == Number(el.className) );
            list[ targetNum ].like++;
            localStorage.setItem('blogList', JSON.stringify(blogList));
            renderList( list, result, user, state );
        });
    });
};
/*LogOff*/
function logOff() {
    const btnLogoBlock = [ ...document.querySelectorAll( 'div#header-block__logo > div > button' ) ];
    btnLogoBlock[ 2 ].onclick = ( e ) => {
        e.preventDefault();
        localStorage.removeItem( 'LogOn' );
        btnLogoBlock[ 2 ].style.display = 'none';
        btnLogoBlock[ 0 ].style.display = 'block';
        btnLogoBlock[ 1 ].style.display = 'block';
        localStorage.setItem( 'LogOn', JSON.stringify( null ) );
        stateStatus( false );
        registration();
    }
};
logOff();
/*Logo Slide*/
setTimeout( () => {
    const logo = [ ...document.querySelectorAll( 'div#header-block__logo > a > img' ) ];
    logo[ 0 ].style.left = '50%';
    logo[ 0 ].style.transition = '1.2s';
    logo[ 0 ].style.transform = 'rotate( 0deg )';
}, 1500 );

// setTimeout( () => {
//     const logo = [ ...document.querySelectorAll( 'div#header-block__logo > a > img' ) ];
//     logo[ 1 ].style.left = '41%';
//     logo[ 1 ].style.transition = '1.2s';
//     logo[ 1 ].style.transform = 'rotate( 0deg )';
// }, 1500 );

// setTimeout( () => {
//     const logo = [ ...document.querySelectorAll( 'div#header-block__logo > a > img' ) ];
//     logo[ 2 ].style.left = '48%';
//     logo[ 2 ].style.transition = '1.2s';
//     logo[ 2 ].style.transform = 'rotate( 0deg )';
// }, 2000 );

// setTimeout( () => {
//     const logo = [ ...document.querySelectorAll( 'div#header-block__logo > a > img' ) ];
//     logo[ 3 ].style.left = '55%';
//     logo[ 3 ].style.transition = '1.2s';
//     logo[ 3 ].style.transform = 'rotate( 360deg )';
// }, 2500 );

setTimeout( () => {
    const menueBtn = document.querySelector( 'div.header-block__menue-button' );
    menueBtn.style.left = '5%';
    menueBtn.style.transition = '1.2s';
}, 1000 );
let userLogged = localStorage.getItem( 'LogOn' ) !== 'null' ? localStorage.getItem( 'LogOn' ).replace( /\"/g, "" ) : 'Anonim';

if( localStorage.getItem( 'LogOn') !== 'null' ) {
    let userFromLocal = localStorage.getItem( 'LogOn', JSON.stringify( userLogged ) );
    stateStatus( true, userLogged );
} else {
    localStorage.setItem( 'LogOn', JSON.stringify( null ) );
    stateStatus();
};

function stateStatus( state = false, user = 'Anonim' , stateArticleOpen = false ) {
    const userName = document.getElementsByClassName( 'header-block__user-name' )[ 0 ];
    const articleArr = [ ...document.querySelectorAll( 'div' ) ];
    const main = document.querySelector( 'main' );
    registeredUser( user );
    if ( state == true ) {
        btnHide();
        selectHeading( user, stateArticleOpen );
        selectTime( user, stateArticleOpen );
        pagination( blogList, user, stateArticleOpen );
        renderList( blogList.slice( 0, 5 ), result, user, stateArticleOpen );
    } else {
        main.style.display = 'none';
        userName.innerHTML = '';
    };
};
/*Open article*/
function openArticle( list, elements, user ) {
    elements.forEach( el => {
        el.onclick = (e) => {

            e.preventDefault();
            let selectArticle = list.filter( el => { 
                return el.number == e.target.className;
            });
            pagination( selectArticle, user );
            renderList( selectArticle, result, user, true );
        };
    })
};
/* Pagination*/
function pagination( obj, user ) {
    let i = 1;
    let startPage = 0;
    let pugNum;
    let arrLink;
    const pageSize = Math.ceil( obj.length/5+1 );
    // const mainBlock = document.querySelector( 'main' );
    const pugBlock = document.getElementById( 'pagination-block' );
          pugBlock.innerHTML = '';
    if ( obj.length > 5 ) {
        while( i < pageSize ) {
            pugNum = document.createElement( 'a' );
            pugNum.innerHTML = i;
            pugBlock.appendChild( pugNum );
            i++;
        };
    };

    if (startPage == 0) {
        renderList(obj.slice(startPage, startPage+5), result, user);
    };

    arrLink = [ ...pugBlock.querySelectorAll( 'a' ) ];

    arrLink.forEach( link => {
        link.addEventListener( 'click', e => {
            e.preventDefault();
            startPage = Number( e.target.text );
            renderList( obj.slice( startPage*5-5, startPage*5 ), result, user);
        });
    });
};
/*Add new article*/
function publickArticle( user ) {
    const pushBtn = document.getElementById( 'push_article' );
    const newTitle = document.getElementById( 'add-article__title' );
    const newImage = document.getElementById( 'add-article__image' );
    console.log(newImage.value.split('\\').reverse()[0]);
    // const reg = /C:\\fakepath/;
    // let newstr = newImage.value.replace(reg, '');
    let newImgSrc = newImage.value.split('\\').reverse()[0];
    const newPage = document.getElementById( 'add-article__page' );
    const selectValue = document.getElementById( 'select_heading' );
    let indexSelect = document.getElementById( 'add-article__select_heading' );
    const select = document.getElementById( 'add-article__select_heading' );
    let addInTopic = filterVal( getValueSelect( selectValue.id ), blogList );
    const newArticle = {
        'number': blogList.length,
        'userPublicated': user,
        'topic': select.options[ indexSelect.options.selectedIndex ].text,
        'image': '../img/' + newImgSrc,
        'title': newTitle.value,
        'time': new Date().getFullYear() + '-' + new Date().getMonth()+1 + '-' + new Date().getDate()+ ' ' + new Date().getHours() + ':' + new Date().getMinutes()+ ':' + new Date().getSeconds(),
        'like': 0,
        'coments': [],
        'page': newPage.value,
    };
    blogList.unshift( newArticle );console.log(blogList)
    localStorage.setItem('blogList', JSON.stringify(blogList));
    if ( newArticle[ 'topic' ] == getValueSelect( selectValue.id ) ) {
        newTitle.value = '';
        newPage.value = '';
        indexSelect.options.selectedIndex = 0;
        renderList( addInTopic, result, user );
        pagination( addInTopic, user );
    } else if ( getValueSelect( selectValue.id ) == 'Select topic' ) {
        newTitle.value = '';
        newPage.value = '';
        indexSelect.options.selectedIndex = 0;
        renderList( blogList,result, user );
        pagination( blogList, user );
    };

    pushBtn.style.height = '10px'
    pushBtn.style.fontSize = '0'
    pushBtn.style.transition = '1s'
};
document.getElementById( 'push_article' ).onclick = () => publickArticle( userLogged, blogList );
/*Registered user*/
function registeredUser( user ) {
    const userName = document.getElementsByClassName( 'header-block__user-name' )[ 0 ];
    const main = document.querySelector( 'main' );
    userName.innerHTML = user;
    userName.style.display = 'block';
    userName.style.top = '5px';
    userName.style.left = '35%';
    userName.style.transition = '1.2s'
    main.style.display = 'block';
};
/*Registration*/
function registration() {
    const logoBtn = [ ...document.querySelectorAll( 'div#header-block__logo > div > button' ) ];
    const regBlock = document.getElementById( 'header-block__registration' );
    const regBtn = regBlock.querySelector( 'button' );
    const signBlock = document.getElementById( 'header-block__sign' );
    const signBtn = signBlock.querySelector( 'button' );
    const regInput = [ ...document.querySelectorAll( 'div#header-block__registration > input' ) ];
    const signInput = [ ...document.querySelectorAll( 'div#header-block__sign > input' ) ];

    logoBtn[ 1 ].onclick = () => {
        signBlock.style.display = 'none';
        regBlock.style.display = 'flex';
    }
    logoBtn[ 0 ].onclick = () => {
        signBlock.style.display = 'flex';
        regBlock.style.display = 'none';
    }
    regProcess( regInput, regBtn );
    signIn( signBtn, signInput, signBlock, regBlock );
};
registration();
/*Render blog*/
// const result  = document.getElementById( 'result' );
function renderList( list, el, user, stateArt ) {
	let arrArticle;
    el.innerHTML='';
    createBlogBlock( list, el, user )
    arrArticle = [ ...document.querySelectorAll( '.article-block > h2' ) ];
    openArticle( list, arrArticle, user );
    liker( list, user, stateArt );
   	comentator( list, user, stateArt );
    deleteComent( list, user, stateArt );
    editComent( list, user );
    articleState( stateArt, user );
};
/* Search on site*/
document.querySelector('#search').oninput = function search() {
    let val = this.value.trim();
    let arrSearch = blogList.filter( el => { 
        return el.page.search(val) !== -1;
    });
    renderList( arrSearch, result, userLogged);
    pagination( arrSearch, userLogged );
};


/*Sort time*/
function sortTime( list, time ) {
    if ( time == 'The newest' ) {
        return list.sort( ( a,b ) => new Date( b.time ).getTime() - new Date( a.time ).getTime() );
    } else if ( time == 'The old' ) {
        return list.sort( ( a,b ) => new Date( a.time ).getTime() - new Date( b.time ).getTime())
    } else if ( time == 'Popular') {
        return list.sort( ( a,b ) => b.like - a.like );
    } else if ( time == 'Unpopular' ) {
        return list.sort( (a,b) => a.like - b.like );
    }
};
/*State status article*/
function articleState( state, user ) {
    if ( state == false ) {
        document.querySelector( '.coment-block' ).style.display = 'none';
    } else if ( state == true ) {
        document.querySelector( '.coment-block' ).style.display = 'block';
        document.querySelector( 'p.article' ).style.height = '100%';
        userColor( user );
    }
};

/*User color*/
function userColor( user ) {
    [ ...document.querySelectorAll( 'div.coment-block__coment-user > a:first-child' ) ]
        .forEach ( el => el.innerHTML == user ? el.style.color = '03a9f475' : el.style.color = '#808080' );
};